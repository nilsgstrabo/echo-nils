apiVersion: radix.equinor.com/v1
kind: RadixApplication
metadata:
  name: echo-nils
spec:
  environments:
    - name: production
      build:
        from: config
  jobs:
    - name: compute
      src: ./compute
      ports:
       - name: http
         port: 3001
      schedulerPort: 8888
      payload:
        path: /payload/body.json
      variables:
        COMPUTE_SOURCE: somewhere
      environmentConfig:
        - environment: production
          variables:
            PORT: 3002
            NODE_ENV: "production"
          monitoring: true
          resources:
            requests:
              memory: "100Mi"
              cpu: "50m"
            limits:
              memory: "50Mi"
              cpu: "20m"      
    # - name: compute2
    #   src: ./compute
    #   ports:
    #    - name: http
    #      port: 3001
    #   schedulerPort: 8888
    #   payload:
    #     path: /payload/body.json
    #   variables:
    #     COMPUTE_SOURCE: somewhere_else
  # cronjobs:
  #   - name: etl
  #     src: ./etl
      # schedule: * 0 0 0 0
      # ports:
      #   - name: http
      #     port: 3000
      # environmentConfig:
      #   - environment: production
      #     schedule: * */2 0 0 0
      # secrets:
      #   - SECRET1
      #   - SECRET2
  components:
    - name: echo
      src: ./echo
      ports:
      - name: http
        port: 3001
      public: false
      environmentConfig:
        - environment: production
          variables:
            PORT: 3001
            NODE_ENV: "production"
          monitoring: true
          # resources:
          #   requests:
          #     memory: "42Mi"
          #     cpu: "10m"
          #   limits:
          #     memory: "50Mi"
          #     cpu: "20m"
          replicas: 1
    # - name: echo2
    #   src: ./echo
    #   ports:
    #   - name: http
    #     port: 3001
    #   public: false
    #   environmentConfig:
    #     - environment: production
    #       variables:
    #         PORT: 3001
    #         NODE_ENV: "production"
    #       monitoring: true
    #       # resources:
    #       #   requests:
    #       #     memory: "42Mi"
    #       #     cpu: "10m"
    #       #   limits:
    #       #     memory: "50Mi"
    #       #     cpu: "20m"
    #       replicas: 1
    - name: www
      src: ./www
      ports:
       - name: http
         port: 3001
      public: true
      secrets:
        - DB_PASSWORD
        - DB_SERVER
        - ANOTHER_SECRET
      environmentConfig:
        - environment: production
          variables:
            PORT: 3001
            NODE_ENV: "production"
            ECHO_URL: "http://echo:3000"
          monitoring: false
          resources:
            requests:
              memory: "50Mi"
              cpu: "10m"
            limits:
              memory: "54Mi"
              cpu: "20m"
          replicas: 1
